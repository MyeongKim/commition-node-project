{{socketTest}}
<div class="detail-header">
	<div class="detail-header-title">
		{{commition.title}}
	</div>
	<div class="detail-header-info">
		<span class="glyphicon glyphicon-eye-open" aria-hidden="true">{{commition.view}}</span>
		<span class="glyphicon glyphicon-heart" aria-hidden="true">{{commition.heart}}</span>
	</div>
</div>
<div class="detail-body">
	<div class="detail-user-info">
		<div class="profile-card">
			<div class="profile-card-img">
				<img src="http://img2.wikia.nocookie.net/__cb20130607025329/creepypasta/images/3/38/Avatar-blank.jpg" class="img-rounded img-responsive">	
			</div>
			<div class="profile-card-detail">
				<div class="profile-card-nickname">
					<a href="/user/mypage/{{commition.user.nickname}}">{{commition.user.nickname}}</a>
				</div>
				<div class="profile-card-introduce">
					<span>{{inputText commition.user.stateMessage}}</span>			
				</div>
				<div class="profile-card-buttons">
					<button class="btn btn-default">팔로잉</button><a href="">{{commition.user.following.length}}</a>
					<button class="btn btn-default">팔로워</button><a href="">{{commition.user.follower.length}}</a>
					{{#if isMine}}
					<button class="btn btn-primary">수정</button>	
					<button id="deleteButton" class="btn btn-primary">삭제</button>
					{{else}}
						{{#if isFollow}}
							<button id="unfollowButton" class="btn btn-primary">언팔로우</button>
						{{else}}
							<button id="followButton" class="btn btn-primary">팔로우</button>
						{{/if}}
					{{/if}}					
				</div>
			</div>
		</div>
	</div>
	<div class="detail-commition-info">
		<div class="detail-commition-info-label">
			<div>
				<button id="duedate" class="btn btn-default">마감일</button><span>{{endTime}}</span>	
			</div>
			<div>
				<button id="slot" class="btn btn-default">슬롯</button><span>{{commition.slot_full}}</span>	
			</div>
		</div>
		<div class="detail-commition-info-buttons">
			<button id="heartButton" class="btn btn-danger btn-lg isFan{{isFan}}"><span class="glyphicon glyphicon-heart" aria-hidden="true"></span></button>
			{{#if isMine}}

			{{else}}
				{{#if isLogin}}
					<button id="buyButton" class="btn btn-success btn-lg" data-toggle="modal" data-target="#buyModal">신청하기</button>
				{{else}}
					<button id="buyButtonWait" class="btn btn-success btn-lg">신청하기</button>
				{{/if}}
			{{/if}}

		</div>
	</div>
	<div class="detail-commition-data">
		<div class="detail-commition-data-label">
			<div>
				<button class="btn btn-default">주의사항</button>
				<p>{{inputText commition.warning}}</p>	
			</div>
			<div>
				<button class="btn btn-default">과정</button>
				<p>{{inputText commition.process}}</p>	
			</div>
			<div>
				<button class="btn btn-default">소요시간</button>
				<p>{{inputText commition.time_spent}}</p>	
			</div>
			<div>
				<button class="btn btn-default">기타</button>
				<p>{{inputText commition.etc}}</p>	
			</div>
			<div>
				<button class="btn btn-default">계좌번호</button>
				<p>{{inputText commition.user.account_number}}</p>
			</div>
		</div>
	</div>
	<div class="detail-commition-types detail-commition-type1">
		<div class="type-title">
			<button class="btn btn-default">타입1</button>
			{{#each commition.type_one.tag}}
			<a href="#">#{{this}}</a>
			{{/each}}
		</div>
		<div class="type-slider">
			<div class="{{isSingle commition.type_one.files_name}}">
				{{#each commition.type_one.files_name}}
					<div data-toggle="modal" data-target="#type_one{{@index}}" class="slider-image-div" style="background-image: url(http://127.0.0.1:8080/uploads/{{this}})"></div>
				{{/each}}
			</div>
		</div>
		{{#each commition.type_one.files_name}}
			<div id="type_one{{@index}}" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<img src="http://127.0.0.1:8080/uploads/{{this}}">
					</div>
				</div>
			</div>
		{{/each}}
		<div class="detail-commition-types-label">
			<div>
				<button class="btn btn-default">사이즈</button>
				<p>{{inputText commition.type_one.files_size}}</p>	
			</div>
			<div>
				<button class="btn btn-default">타입 설명</button>
				<p>{{inputText commition.type_one.type_desc}}</p>	
			</div>
			<div>
				<button class="btn btn-default">가격</button>
				<p>{{inputText commition.type_one.price}}</p>	
			</div>
		</div>
	</div>
	<div class="detail-commition-types detail-commition-type2">
		<div class="type-title">
			<button class="btn btn-default">타입2</button>
			{{#each commition.type_two.tag}}
			<a href="#">#{{this}}</a>
			{{/each}}
		</div>
		<div class="type-slider">
			<div class="{{isSingle commition.type_two.files_name}}">
				{{#each commition.type_two.files_name}}
				<div data-toggle="modal" data-target="#type_two{{@index}}" class="slider-image-div" style="background-image: url(http://127.0.0.1:8080/uploads/{{this}})"></div>
				{{/each}}
			</div>
		</div>
		{{#each commition.type_two.files_name}}
			<div id="type_two{{@index}}" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<img src="http://127.0.0.1:8080/uploads/{{this}}">
					</div>
				</div>
			</div>
		{{/each}}
		<div class="detail-commition-types-label">
			<div>
				<button class="btn btn-default">사이즈</button>
				<p>{{inputText commition.type_two.files_size}}</p>	
			</div>
			<div>
				<button class="btn btn-default">타입 설명</button>
				<p>{{inputText commition.type_two.type_desc}}</p>	
			</div>
			<div>
				<button class="btn btn-default">가격</button>
				<p>{{inputText commition.type_two.price}}</p>	
			</div>
		</div>
	</div>
	<div class="detail-commition-types detail-commition-type3">
		<div class="type-title">
			<button class="btn btn-default">타입3</button>
			{{#each commition.type_three.tag}}
			<a href="#">#{{this}}</a>
			{{/each}}
		</div>
		<div class="type-slider">
			<div class="{{isSingle commition.type_three.files_name}}">
				{{#each commition.type_three.files_name}}
				<div data-toggle="modal" data-target="#type_three{{@index}}" class="slider-image-div" style="background-image: url(http://127.0.0.1:8080/uploads/{{this}})"></div>
				{{/each}}
			</div> 
		</div>
		{{#each commition.type_three.files_name}}
			<div id="type_three{{@index}}" class="modal fade bs-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
				<div class="modal-dialog modal-lg">
					<div class="modal-content">
						<img src="http://127.0.0.1:8080/uploads/{{this}}">
					</div>
				</div>
			</div>
		{{/each}}
		<div class="detail-commition-types-label">
			<div>
				<button class="btn btn-default">사이즈</button>
				<p>{{inputText commition.type_three.files_size}}</p>	
			</div>
			<div>
				<button class="btn btn-default">타입 설명</button>
				<p>{{inputText commition.type_three.type_desc}}</p>	
			</div>
			<div>
				<button class="btn btn-default">가격</button>
				<p>{{inputText commition.type_three.price}}</p>
			</div>
			{{loginUser}}
		</div>
	</div>
</div>

{{!-- buy modal --}}
<div class="modal fade" id="buyModal">
  	<div class="modal-dialog">
		<div class="modal-content">
	  		<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
			<h4 class="modal-title">신청 페이지</h4>
	  		</div>
		  	<div class="modal-body">
				<form id="requestForm" method="post" action="/submit/request" enctype="multipart/form-data" >
					<input type="hidden" id="time" name="time">
					<input type="hidden" name="toUser" value="{{commition.user._id}}">
					<input type="hidden" name="ref_commition" value="{{commition._id}}">
			  		<div class="form-group">
						<label class="control-label">닉네임</label>
						<input type="text" name="nickname" class="form-control" value="{{loginUser.nickname}}" readonly>
			  		</div>
			  		<div class="form-group">
						<label class="control-label">타입</label>
						<select name="type" class="form-control">
							<option>타입 1</option>
							<option>타입 2</option>
							<option>타입 3</option>
						</select>
			  		</div>
			  		<div class="form-group">
						<label class="control-label">연락처</label>
						<input type="text" name="phone" class="form-control" value="">
			  		</div>
			  		<div class="form-group">
						<label class="control-label">입금자명</label>
						<input type="text" name="deposit_name" class="form-control" value="">
			  		</div>
			  		<div class="form-group">
						<label class="control-label">요청사항</label>
						<textarea name="request_desc" class="form-control" rows="3"></textarea>
			  		</div>
			  		<div class="form-group">
			  			<label class="control-label">사진자료 선택</label>
						<input type="file" name="refer_files_name" multiple>
						<p class="help-block">캐릭터 외향이나 포즈에 대한 참고 사진자료를 첨부해주세요.(최대 9개)</p>
					</div>  		
				</form>
		  	</div>
		  	<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">닫기</button>
				<button type="submit" id="requestFormSubmitButton" class="btn btn-primary">신청하기</button>
		  	</div>
		</div>
  	</div>
</div>

<script type="text/javascript">
	(function(){
		var socket = io.connect('http://127.0.0.1:8080');
		$(function(){
			socket.emit('viewPlus', { csId: "{{commition._id}}"});
			document.getElementById("time").value = Date.now();

			$('#heartButton').click(function(){
				if({{isFan}}){
					socket.emit('cancelHeartPlus', { csId: "{{commition._id}}", userId : "{{loginUser._id}}"});
					alert("하트를 취소했습니다.");
					location.reload();
				} else {
					socket.emit('heartPlus', { csId: "{{commition._id}}", userId : "{{loginUser._id}}"});
					alert("하트 목록에 추가했습니다.");
					location.reload();
				}
			});

			$('#deleteButton').click(function(){
				if(confirm("커미션을 삭제할까요?")){
					socket.emit('cancelHeartPlus', { csId: "{{commition._id}}", userId : "{{loginUser._id}}"});
					alert("커미션을 삭제했습니다.");
					location.href = '/';
				}
			});

			$('#followButton').click(function(){
				socket.emit('followPlus', { creatorId: "{{commition.user._id}}", userId : "{{loginUser._id}}"});
				location.reload();
			});

			$('#unfollowButton').click(function(){
				socket.emit('followMinus', { creatorId: "{{commition.user._id}}", userId : "{{loginUser._id}}"});
				location.reload();
			});

			$('#buyButton').click(function(){

			});

			$('#buyButtonWait').click(function(){
				alert("먼저 로그인해주세요.")
				location.href= '/user/login';
			});

			$('#requestFormSubmitButton').click(function(){
				$('#requestForm').submit();
			});
		});
	})();
</script>